{% extends 'blog/base.html' %}
{% block title %}{{ post.title }} - Blog{% endblock %}

{% block content %}

<!-- Post Card -->
<div class="card mb-3">
  <div class="card-body">
    <h2>{{ post.title }}</h2>
    <p class="text-muted">
      By {{ post.author.username }} • {{ post.created_at|date:'M d, Y' }}
    </p>

    {% if post.feature_image %}
      <img src="{{ post.feature_image.url }}" class="img-fluid mb-3" alt="{{ post.title }}">
    {% endif %}

    <div class="mb-4">
      {{ post.content|safe }}
    </div>

    <div class="mb-4">
      <strong>Category:</strong>
      {% if post.category %}
        <a href="{% url 'category_posts' post.category.slug %}">
            {{ post.category.name }}
        </a>
      {% else %}
        <span class="text-muted">Uncategorized</span>
      {% endif %}
    </div>
  </div>
</div>


<!-- Comments Section -->
<h5>Comments</h5>

{% for comment in comments %}
  <div class="mb-3 border rounded p-2">
    <div class="d-flex justify-content-between">

      <div>
        <strong>{{ comment.user.username }}</strong>
        <small class="text-muted"> — {{ comment.created_at|date:'M d, Y H:i' }}</small>
      </div>

      <div>
        {% if user.is_authenticated and user == comment.user or user.is_authenticated and user == post.author or user.is_staff %}
          <form method="post" action="{% url 'comment_delete' comment.pk %}" style="display:inline;">
            {% csrf_token %}
            <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
          </form>
        {% endif %}
      </div>
    </div>

    <p class="mb-0 mt-2">{{ comment.body }}</p>
  </div>

{% empty %}
  <p>No comments yet.</p>
{% endfor %}


<!-- Add Comment Form -->
{% if user.is_authenticated %}
  <div class="card mt-3 p-3">
    <form method="post" action="{% url 'add_comment' post.id %}">
      {% csrf_token %}
      {{ comment_form.as_p }}
      <button class="btn btn-primary">Add Comment</button>
    </form>
  </div>

{% else %}
  <p class="mt-3">
    <a href="{% url 'login' %}">Login</a> to comment.
  </p>
{% endif %}

{% endblock %}
